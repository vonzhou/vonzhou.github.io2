<!doctype html>
<html class="theme-next use-motion ">
<head>
  

<meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>


<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />








  <link rel="stylesheet" type="text/css" href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5"/>



  
    <link href='//fonts.googleapis.com/css?family=Lato:300,400,700,400italic&subset=latin,latin-ext' rel='stylesheet' type='text/css'>
  


<link rel="stylesheet" type="text/css" href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" />

<link rel="stylesheet" type="text/css" href="/css/main.css?v=0.4.5.2"/>




  <meta name="keywords" content="Hexo,next" />





  <link rel="shortcut icon" type="image/x-icon" href="/assets/favicon.ico?v=0.4.5.2" />


<meta name="description">
<meta property="og:type" content="website">
<meta property="og:title" content="Chown's Blog">
<meta property="og:url" content="https://vonzhou.github.io/index.html">
<meta property="og:site_name" content="Chown's Blog">
<meta property="og:description">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chown's Blog">
<meta name="twitter:description">


<script type="text/javascript" id="hexo.configuration">
  var CONFIG = {
    scheme: '',
    sidebar: 'post'
  };
</script>



  <title> Chown's Blog </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="default">

  <!--[if lte IE 8]>
  <div style=' clear: both; height: 59px; padding:0 0 0 15px; position: relative;margin:0 auto;'>
    <a href="http://windows.microsoft.com/en-US/internet-explorer/products/ie/home?ocid=ie6_countdown_bannercode">
      <img src="http://7u2nvr.com1.z0.glb.clouddn.com/picouterie.jpg" border="0" height="42" width="820"
           alt="You are using an outdated browser. For a faster, safer browsing experience, upgrade for free today or use other browser ,like chrome firefox safari."
           style='margin-left:auto;margin-right:auto;display: block;'/>
    </a>
  </div>
<![endif]-->
  






  <div class="container one-column 
   page-home 
">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Chown's Blog</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">人的一切痛苦，本质上都是对自己的无能的愤怒。</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu ">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-th"></i> <br />
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-user"></i> <br />
            
            About
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      

      
      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div id="content" class="content"> 
  <section id="posts" class="posts-expand">
    
      

  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                <a class="post-title-link" href="/2015/10/22/2015-10-22-parse-packet-in-pox/" itemprop="url">
                  在POX中操作数据包
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            Posted on
            <time itemprop="dateCreated" datetime="2015-10-22T17:17:30+08:00" content="2015-10-22">
              2015-10-22
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; In
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/SDN/" itemprop="url" rel="index">
                    <span itemprop="name">SDN</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>想在SDN控制器中做点事情，必须要能够解析上来的packet，在POX中利用pox.lib.packet中的组件很方便，重点是熟悉各个协议的字段。</p>
<p>各个协议类继承了<strong>packet_base</strong>, 里面的find 方法很实用，在解析packet的时候， find(‘protocol’)就会解析得到对应协议的包。</p>
<p>解析到传输层后的payload类型是str，我们可以探测里面的内容，但是长度不一定是整个packet（可以修改）。</p>
<p>下面是我解析UDP包的过程，得到里面的内容之后，就可以对应设计自己的策略。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">spy_udp_packet</span><span class="params">(self, packet)</span>:</span></span><br><span class="line">    ip = packet.find(<span class="string">'ipv4'</span>)</span><br><span class="line">    <span class="keyword">if</span> ip <span class="keyword">is</span> <span class="keyword">None</span>:</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    log.debug(<span class="string">'protocol=&#123;&#125;,srcip=&#123;&#125;,dstip=&#123;&#125;'</span>.format(ip.protocol, ip.srcip, ip.dstip))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># we only care about UDP packet</span></span><br><span class="line">    udp_packet = ip.find(<span class="string">'udp'</span>)</span><br><span class="line">    <span class="keyword">if</span> udp_packet <span class="keyword">is</span> <span class="keyword">None</span>:</span><br><span class="line">      <span class="keyword">return</span> </span><br><span class="line">    log.debug(<span class="string">'srcport=&#123;&#125;,dstport=&#123;&#125;'</span>.format(udp_packet.srcport, udp_packet.dstport))</span><br><span class="line">    udp_payload = udp_packet.payload </span><br><span class="line">    <span class="comment"># The payload include a '\n' , and its type is &lt;type 'str'&gt;</span></span><br><span class="line">    log.debug(<span class="string">'udp playload(len=&#123;&#125;): &#123;&#125;,type=&#123;&#125;'</span>.format(len(udp_payload), str(udp_payload), type(udp_payload)))</span><br></pre></td></tr></table></figure>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                <a class="post-title-link" href="/2015/10/22/2015-10-22-linux-find-command/" itemprop="url">
                  Linux find command
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            Posted on
            <time itemprop="dateCreated" datetime="2015-10-22T08:55:05+08:00" content="2015-10-22">
              2015-10-22
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; In
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index">
                    <span itemprop="name">Linux</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">-<span class="property">name</span> pattern</span><br><span class="line">            Base <span class="keyword">of</span> <span class="type">file</span> <span class="property">name</span> (<span class="keyword">the</span> path <span class="keyword">with</span> <span class="keyword">the</span> leading directories removed) matches shell pattern pattern.  The metacharacters (`*',  `?',  <span class="keyword">and</span></span><br><span class="line">            `[]')  match  a `.' <span class="keyword">at</span> <span class="keyword">the</span> start <span class="keyword">of</span> <span class="keyword">the</span> base <span class="property">name</span> (this <span class="keyword">is</span> a change <span class="keyword">in</span> findutils-<span class="number">4.2</span><span class="number">.2</span>; see section STANDARDS CONFORMANCE <span class="keyword">below</span>).  To</span><br><span class="line">            ignore a directory <span class="keyword">and</span> <span class="keyword">the</span> files under <span class="keyword">it</span>, use -prune; see an example <span class="keyword">in</span> <span class="keyword">the</span> description <span class="keyword">of</span> -path.   Braces  are  <span class="keyword">not</span>  recognised  <span class="keyword">as</span></span><br><span class="line">            being  special, despite <span class="keyword">the</span> fact <span class="keyword">that</span> <span class="keyword">some</span> shells including Bash imbue braces <span class="keyword">with</span> a special meaning <span class="keyword">in</span> shell patterns.  The filename</span><br><span class="line">            matching <span class="keyword">is</span> performed <span class="keyword">with</span> <span class="keyword">the</span> use <span class="keyword">of</span> <span class="keyword">the</span> fnmatch(<span class="number">3</span>) library function.   Don't forget <span class="keyword">to</span> enclose <span class="keyword">the</span> pattern <span class="keyword">in</span> quotes  <span class="keyword">in</span>  order  <span class="keyword">to</span></span><br><span class="line">            protect <span class="keyword">it</span> <span class="keyword">from</span> expansion <span class="keyword">by</span> <span class="keyword">the</span> shell.</span><br><span class="line">            </span><br><span class="line">      q</span><br></pre></td></tr></table></figure>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                <a class="post-title-link" href="/2015/10/22/2015-10-21-Mininet-Everyday_Usage/" itemprop="url">
                  Mininet Everyday Usage
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            Posted on
            <time itemprop="dateCreated" datetime="2015-10-22T08:46:21+08:00" content="2015-10-22">
              2015-10-22
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; In
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/SDN/" itemprop="url" rel="index">
                    <span itemprop="name">SDN</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <h1 id="Mininet_Everyday_Usage">Mininet Everyday Usage</h1><h2 id="启动mininet模拟器_mn">启动mininet模拟器 mn</h2><p>mn 默认建立最小尺寸的拓扑，相当于指定 –topo=minimal, 俩主机通过一个OF交换机相连， 使用自带的控制器。命令参数如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line">NAME</span><br><span class="line">       mn - <span class="operator"><span class="keyword">create</span> a Mininet network.</span><br><span class="line"></span><br><span class="line">SYNOPSIS</span><br><span class="line">       mn [options]</span><br><span class="line"></span><br><span class="line">DESCRIPTION</span><br><span class="line">       (<span class="keyword">type</span> mn -h <span class="keyword">for</span> details)</span><br><span class="line"></span><br><span class="line">       The mn utility creates Mininet network <span class="keyword">from</span> the command line. It can <span class="keyword">create</span> parametrized topologies, invoke the Mininet CLI, <span class="keyword">and</span> run tests.</span><br><span class="line"></span><br><span class="line">OPTIONS</span><br><span class="line">       -h, <span class="comment">--help</span></span><br><span class="line">              <span class="keyword">show</span> this <span class="keyword">help</span> message <span class="keyword">and</span> <span class="keyword">exit</span></span><br><span class="line"></span><br><span class="line">       <span class="comment">--switch=SWITCH</span></span><br><span class="line">              <span class="keyword">default</span>|ivs|lxbr|ovs|ovsbr|ovsk|<span class="keyword">user</span>[,param=<span class="keyword">value</span>...]   ovs=OVSSwitch  <span class="keyword">default</span>=OVSSwitch  ovsk=OVSSwitch  lxbr=LinuxBridge <span class="keyword">user</span>=<span class="keyword">User</span>‐</span><br><span class="line">              <span class="keyword">Switch</span> ivs=IVSSwitch ovsbr=OVSBridge</span><br><span class="line"></span><br><span class="line">       <span class="comment">--host=HOST</span></span><br><span class="line">              cfs|proc|rt[,param=<span class="keyword">value</span>...]  rt=CPULimitedHost&#123;<span class="string">'sched'</span>: <span class="string">'rt'</span>&#125; proc=Host cfs=CPULimitedHost&#123;<span class="string">'sched'</span>: <span class="string">'cfs'</span>&#125;</span><br><span class="line"></span><br><span class="line">       <span class="comment">--controller=CONTROLLER</span></span><br><span class="line">              <span class="keyword">default</span>|<span class="keyword">none</span>|nox|ovsc|<span class="keyword">ref</span>|remote|ryu[,param=<span class="keyword">value</span>...]       ovsc=OVSController      <span class="keyword">none</span>=NullController       remote=RemoteController</span><br><span class="line">              <span class="keyword">default</span>=DefaultController nox=NOX ryu=Ryu <span class="keyword">ref</span>=Controller</span><br><span class="line"></span><br><span class="line">       <span class="comment">--link=LINK</span></span><br><span class="line">              <span class="keyword">default</span>|ovs|tc[,param=<span class="keyword">value</span>...] <span class="keyword">default</span>=<span class="keyword">Link</span> ovs=OVSLink tc=TCLink</span><br><span class="line"></span><br><span class="line">       <span class="comment">--topo=TOPO</span></span><br><span class="line">              linear|minimal|reversed|single|torus|tree[,param=<span class="keyword">value</span>  ...]  linear=LinearTopo  reversed=SingleSwitchReversedTopo tree=TreeTopo <span class="keyword">sin</span>‐</span><br><span class="line">              gle=SingleSwitchTopo torus=TorusTopo minimal=MinimalTopo</span><br><span class="line"></span><br><span class="line">       -<span class="keyword">c</span>, <span class="comment">--clean</span></span><br><span class="line">              clean <span class="keyword">and</span> <span class="keyword">exit</span></span><br><span class="line">		<span class="comment">--custom=CUSTOM</span></span><br><span class="line">              <span class="keyword">read</span> custom classes <span class="keyword">or</span> params <span class="keyword">from</span> .py <span class="keyword">file</span>(s)</span><br><span class="line"></span><br><span class="line">       <span class="comment">--test=TEST</span></span><br><span class="line">              cli|<span class="keyword">build</span>|pingall|pingpair|iperf|all|iperfudp|<span class="keyword">none</span></span><br><span class="line"></span><br><span class="line">       -x, <span class="comment">--xterms</span></span><br><span class="line">              spawn xterms <span class="keyword">for</span> <span class="keyword">each</span> node</span><br><span class="line"></span><br><span class="line">       -<span class="keyword">i</span> IPBASE, <span class="comment">--ipbase=IPBASE</span></span><br><span class="line">              base IP address <span class="keyword">for</span> <span class="keyword">hosts</span></span><br><span class="line"></span><br><span class="line">       <span class="comment">--mac  automatically set host MACs</span></span><br><span class="line"></span><br><span class="line">       <span class="comment">--arp  set all-pairs ARP entries</span></span><br><span class="line"></span><br><span class="line">       -v VERBOSITY, <span class="comment">--verbosity=VERBOSITY</span></span><br><span class="line">              info|<span class="keyword">warning</span>|<span class="keyword">critical</span>|<span class="keyword">error</span>|debug|<span class="keyword">output</span></span><br><span class="line"></span><br><span class="line">       <span class="comment">--innamespace</span></span><br><span class="line">              sw <span class="keyword">and</span> ctrl <span class="keyword">in</span> namespace?</span><br><span class="line"></span><br><span class="line">       <span class="comment">--listenport=LISTENPORT</span></span><br><span class="line">              base port <span class="keyword">for</span> passive <span class="keyword">switch</span> listening</span><br><span class="line"></span><br><span class="line">       <span class="comment">--nolistenport</span></span><br><span class="line">              don<span class="string">'t use passive listening port</span><br><span class="line"></span><br><span class="line">       --pre=PRE</span><br><span class="line">              CLI script to run before tests</span><br><span class="line">       --post=POST</span><br><span class="line">              CLI script to run after tests</span><br><span class="line"></span><br><span class="line">       --pin  pin hosts to CPU cores (requires --host cfs or --host rt)</span><br><span class="line"></span><br><span class="line">       --nat  adds a NAT to the topology that connects Mininet hosts to the physical network. Warning: This may route any traffic  on  the  machine</span><br><span class="line">              that uses Mininet'</span>s IP subnet <span class="keyword">into</span> the Mininet network. <span class="keyword">If</span> you need <span class="keyword">to</span> <span class="keyword">change</span> Mininet<span class="string">'s IP subnet, see the --ipbase option.</span><br><span class="line"></span><br><span class="line">       --version</span><br><span class="line">              prints the version and exits</span><br><span class="line"></span><br><span class="line">       --cluster=server1,server2...</span><br><span class="line">              run on multiple servers (experimental!)</span><br><span class="line"></span><br><span class="line">       --placement=block|random</span><br><span class="line">              node placement for --cluster (experimental!)</span></span></span><br></pre></td></tr></table></figure>
<h2 id="Mininet_CLI常用命令：">Mininet CLI常用命令：</h2><p>nodes #展现节点</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mininet&gt; nodes</span><br><span class="line">available nodes are: </span><br><span class="line">c0 <span class="tag">h1</span> <span class="tag">h2</span> s1</span><br></pre></td></tr></table></figure>
<p>net # 展现网络链接</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mininet&gt; net</span><br><span class="line">h1 h1-<span class="string">eth0:</span>s1-eth1</span><br><span class="line">h2 h2-<span class="string">eth0:</span>s1-eth2</span><br><span class="line">s1 <span class="string">lo:</span>  s1-<span class="string">eth1:</span>h1-eth0 s1-<span class="string">eth2:</span>h2-eth0</span><br><span class="line">c0</span><br></pre></td></tr></table></figure>
<p>dump #各个节点的信息</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mininet&gt; dump</span><br><span class="line">&lt;Host h1: h1-eth0:<span class="number">10.0</span><span class="number">.0</span><span class="number">.1</span> pid=<span class="number">3088</span>&gt; </span><br><span class="line">&lt;Host h2: h2-eth0:<span class="number">10.0</span><span class="number">.0</span><span class="number">.2</span> pid=<span class="number">3090</span>&gt; </span><br><span class="line">&lt;OVSSwitch s1: lo:<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>,s1-eth1:None,s1-eth2:None pid=<span class="number">3095</span>&gt; </span><br><span class="line">&lt;Controller c0: <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6633</span> pid=<span class="number">3081</span>&gt;</span><br></pre></td></tr></table></figure>
<p>如果第一个参数是主机名，交换机名，或者控制器名，那么表示后面的命令在对应的节点上执行。比如 h1 ifconfig -a 会显示出h1主机网络命名空间的接口信息。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">mininet&gt; h1 ifconfig -a</span><br><span class="line">h1-eth0   Link encap:Ethernet  HWaddr <span class="number">4</span>a:<span class="number">2</span>b:e3:ff:d5:<span class="number">48</span>  </span><br><span class="line">          inet addr:<span class="number">10.0</span><span class="number">.0</span><span class="number">.1</span>  Bcast:<span class="number">10.255</span><span class="number">.255</span><span class="number">.255</span>  Mask:<span class="number">255.0</span><span class="number">.0</span><span class="number">.0</span></span><br><span class="line">          inet6 addr: fe80::<span class="number">482</span>b:e3ff:feff:d548/<span class="number">64</span> Scope:Link</span><br><span class="line">          UP BROADCAST RUNNING MULTICAST  MTU:<span class="number">1500</span>  Metric:<span class="number">1</span></span><br><span class="line">          RX packets:<span class="number">40</span> errors:<span class="number">0</span> dropped:<span class="number">0</span> overruns:<span class="number">0</span> frame:<span class="number">0</span></span><br><span class="line">          TX packets:<span class="number">14</span> errors:<span class="number">0</span> dropped:<span class="number">0</span> overruns:<span class="number">0</span> carrier:<span class="number">0</span></span><br><span class="line">          collisions:<span class="number">0</span> txqueuelen:<span class="number">1000</span> </span><br><span class="line">          RX bytes:<span class="number">5659</span> (<span class="number">5.6</span> KB)  TX bytes:<span class="number">1028</span> (<span class="number">1.0</span> KB)</span><br><span class="line"></span><br><span class="line">lo        Link encap:Local Loopback  </span><br><span class="line">          inet addr:<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>  Mask:<span class="number">255.0</span><span class="number">.0</span><span class="number">.0</span></span><br><span class="line">          inet6 addr: ::<span class="number">1</span>/<span class="number">128</span> Scope:Host</span><br><span class="line">          UP LOOPBACK RUNNING  MTU:<span class="number">16436</span>  Metric:<span class="number">1</span></span><br><span class="line">          RX packets:<span class="number">0</span> errors:<span class="number">0</span> dropped:<span class="number">0</span> overruns:<span class="number">0</span> frame:<span class="number">0</span></span><br><span class="line">          TX packets:<span class="number">0</span> errors:<span class="number">0</span> dropped:<span class="number">0</span> overruns:<span class="number">0</span> carrier:<span class="number">0</span></span><br><span class="line">          collisions:<span class="number">0</span> txqueuelen:<span class="number">0</span> </span><br><span class="line">          RX bytes:<span class="number">0</span> (<span class="number">0.0</span> B)  TX bytes:<span class="number">0</span> (<span class="number">0.0</span> B)</span><br></pre></td></tr></table></figure>
<h2 id=":q">:q</h2><p>:qqq</p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                <a class="post-title-link" href="/2015/10/21/2015-10-21-Create-a-learning-switch-in-pox/" itemprop="url">
                  基于POX实现L2 learning switch模块
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            Posted on
            <time itemprop="dateCreated" datetime="2015-10-21T17:39:37+08:00" content="2015-10-21">
              2015-10-21
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; In
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/SDN/" itemprop="url" rel="index">
                    <span itemprop="name">SDN</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <h1 id="基于POX实现L2_learning_switch模块">基于POX实现L2 learning switch模块</h1><h2 id="实现一个hub">实现一个hub</h2><p>实现一个hub很简单，就是在controller收到packet-in时通过openflow packet-out从其他端口转发出去，下面测试下HUB 的行为：</p>
<p>通过xterm为h1,h2,h3开启一个终端，然后使用tcpdump抓取数据包，然后在h1中ping，可以清晰的看到数据包的流动，ARP，icmp echo request, icmp echo reply这个包，h2 h3都会收到，也就是对于任何pakcet都会触发pakcet-in,然后通过广播传出其他端口，这就是hub的工作方式。</p>
<p><img src="/assets/mininet/hub-behavior.png" alt=""></p>
<p>如果在h1中ping一个不存在的主机，那么就会询问3次，“who has 10.0.0.5 tell 10.0.0.1”,仍没有回应，就是丢包的象征。</p>
<p><img src="/assets/mininet/hub-behavior-2.png" alt=""></p>
<h2 id="实现L2_learning_switch">实现L2 learning switch</h2><p>想清晰了不难，重点是学习pox中的API，多动手。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"""</span><br><span class="line">This component is for use with the OpenFlow tutorial.</span><br><span class="line"></span><br><span class="line">It acts as a simple hub, but can be modified to act like an L2</span><br><span class="line">learning switch.</span><br><span class="line"></span><br><span class="line">It's roughly similar to the one Brandon Heller did for NOX.</span><br><span class="line">"""</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pox.core <span class="keyword">import</span> core</span><br><span class="line"><span class="keyword">import</span> pox.openflow.libopenflow_01 <span class="keyword">as</span> of</span><br><span class="line"></span><br><span class="line">log = core.getLogger()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Tutorial</span> <span class="params">(object)</span>:</span></span><br><span class="line">  <span class="string">"""</span><br><span class="line">  A Tutorial object is created for each switch that connects.</span><br><span class="line">  A Connection object for that switch is passed to the __init__ function.</span><br><span class="line">  """</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">__init__</span> <span class="params">(self, connection)</span>:</span></span><br><span class="line">    <span class="comment"># Keep track of the connection to the switch so that we can</span></span><br><span class="line">    <span class="comment"># send it messages!</span></span><br><span class="line">    self.connection = connection</span><br><span class="line"></span><br><span class="line">    <span class="comment"># This binds our PacketIn event listener</span></span><br><span class="line">    connection.addListeners(self)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Use this table to keep track of which ethernet address is on</span></span><br><span class="line">    <span class="comment"># which switch port (keys are MACs, values are ports).</span></span><br><span class="line">    self.mac_to_port = &#123;&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">resend_packet</span> <span class="params">(self, packet_in, out_port)</span>:</span></span><br><span class="line">    <span class="string">"""</span><br><span class="line">    Instructs the switch to resend a packet that it had sent to us.</span><br><span class="line">    "packet_in" is the ofp_packet_in object the switch had sent to the</span><br><span class="line">    controller due to a table-miss.</span><br><span class="line">    """</span></span><br><span class="line">    msg = of.ofp_packet_out()</span><br><span class="line">    msg.data = packet_in</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Add an action to send to the specified port</span></span><br><span class="line">    action = of.ofp_action_output(port = out_port)</span><br><span class="line">    msg.actions.append(action)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Send openflow message to a switch</span></span><br><span class="line">    self.connection.send(msg)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">act_like_hub</span> <span class="params">(self, packet, packet_in)</span>:</span></span><br><span class="line">    <span class="string">"""</span><br><span class="line">    Implement hub-like behavior -- send all packets to all ports besides</span><br><span class="line">    the input port.</span><br><span class="line">    """</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># We want to output to all ports -- we do that using the special</span></span><br><span class="line">    <span class="comment"># OFPP_ALL port as the output port.  (We could have also used</span></span><br><span class="line">    <span class="comment"># OFPP_FLOOD.)</span></span><br><span class="line">    self.resend_packet(packet_in, of.OFPP_ALL)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Note that if we didn't get a valid buffer_id, a slightly better</span></span><br><span class="line">    <span class="comment"># implementation would check that we got the full data before</span></span><br><span class="line">    <span class="comment"># sending it (len(packet_in.data) should be == packet_in.total_len)).</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">act_like_switch</span> <span class="params">(self, packet, packet_in)</span>:</span></span><br><span class="line">    <span class="string">"""</span><br><span class="line">    Implement switch-like behavior.</span><br><span class="line">    """</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Here's some psuedocode to start you off implementing a learning</span></span><br><span class="line">    <span class="comment"># switch.  You'll need to rewrite it as real Python code.</span></span><br><span class="line"></span><br><span class="line">    log.debug(<span class="string">'Packet from &#123;&#125; to &#123;&#125; from port &#123;&#125;'</span>.format(packet.src, packet.dst, packet_in.in_port))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Learn the port for the source MAC, mac,in_port pair</span></span><br><span class="line">    self.mac_to_port[packet.src] = packet_in.in_port</span><br><span class="line">    dst_port = self.mac_to_port.get(packet.dst)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> dst_port <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>:</span><br><span class="line">      log.debug(<span class="string">'Packet destinated to &#123;&#125; should go to port &#123;&#125;'</span>.format(packet.dst, dst_port))</span><br><span class="line"></span><br><span class="line">      <span class="comment"># Send packet out the associated port</span></span><br><span class="line">      self.resend_packet(packet_in, dst_port)</span><br><span class="line"></span><br><span class="line">      <span class="comment"># Once you have the above working, try pushing a flow entry</span></span><br><span class="line">      <span class="comment"># instead of resending the packet </span></span><br><span class="line"></span><br><span class="line">      log.debug(<span class="string">"Installing flow (&#123;&#125;,&#123;&#125;) to (&#123;&#125;,&#123;&#125;)"</span>.format(packet.src, packet_in.in_port, packet.dst, dst_port))</span><br><span class="line">      <span class="comment"># Maybe the log statement should have source/destination/port? Yes</span></span><br><span class="line"></span><br><span class="line">      msg = of.ofp_flow_mod()</span><br><span class="line">      </span><br><span class="line">      <span class="comment"># Set fields to match received packet</span></span><br><span class="line">      msg.match = of.ofp_match.from_packet(packet)</span><br><span class="line">      </span><br><span class="line">      <span class="comment">#&lt; Set other fields of flow_mod (timeouts? buffer_id?) &gt;</span></span><br><span class="line">      msg.idle_timeout = <span class="number">60</span></span><br><span class="line">      msg.match.in_port = packet_in.in_port</span><br><span class="line">      </span><br><span class="line">      <span class="comment">#&lt; Add an output action, and send -- similar to resend_packet() &gt;</span></span><br><span class="line">      action = of.ofp_action_output(port = dst_port)</span><br><span class="line">      msg.actions.append(action)</span><br><span class="line">      self.connection.send(msg)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">      <span class="comment"># Flood the packet out everything but the input port</span></span><br><span class="line">      <span class="comment"># This part looks familiar, right?</span></span><br><span class="line">      log.debug(<span class="string">'Donot know which port &#123;&#125; should go to'</span>.format(packet.dst))</span><br><span class="line">      self.resend_packet(packet_in, of.OFPP_ALL)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">_handle_PacketIn</span> <span class="params">(self, event)</span>:</span></span><br><span class="line">    <span class="string">"""</span><br><span class="line">    Handles packet in messages from the switch.</span><br><span class="line">    """</span></span><br><span class="line"></span><br><span class="line">    packet = event.parsed <span class="comment"># This is the parsed packet data.</span></span><br><span class="line">    <span class="comment">#print dir(packet) #all members of packet object</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> packet.parsed:</span><br><span class="line">      log.warning(<span class="string">"Ignoring incomplete packet"</span>)</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    packet_in = event.ofp <span class="comment"># The actual ofp_packet_in message.</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Comment out the following line and uncomment the one after</span></span><br><span class="line">    <span class="comment"># when starting the exercise.</span></span><br><span class="line">    <span class="comment">#self.act_like_hub(packet, packet_in)</span></span><br><span class="line">    self.act_like_switch(packet, packet_in)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">launch</span> <span class="params">()</span>:</span></span><br><span class="line">  <span class="string">"""</span><br><span class="line">  Starts the component</span><br><span class="line">  """</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">start_switch</span> <span class="params">(event)</span>:</span></span><br><span class="line">    log.debug(<span class="string">"Controlling %s"</span> % (event.connection,))</span><br><span class="line">    Tutorial(event.connection)</span><br><span class="line"></span><br><span class="line">  <span class="comment"># When comes a switch connection, fired a ConnectionUp event.</span></span><br><span class="line">  <span class="comment"># THe Connection object is the channel between switch and controller </span></span><br><span class="line">  core.openflow.addListenerByName(<span class="string">"ConnectionUp"</span>, start_switch)</span><br></pre></td></tr></table></figure>
<p>测试,可以看到时间对比</p>
<p><img src="/assets/mininet/of_tutorial_switch_1.png" alt=""></p>
<p><img src="/assets/mininet/of_tutorial_switch_2.png" alt=""></p>
<p>参考</p>
<p><a href="">openflow-tutorial</a></p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                <a class="post-title-link" href="/2015/10/21/2015-6-4-Sending Signal/" itemprop="url">
                  Sending signals between processes
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            Posted on
            <time itemprop="dateCreated" datetime="2015-10-21T13:34:11+08:00" content="2015-10-21">
              2015-10-21
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; In
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index">
                    <span itemprop="name">Linux</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>  In Linux, the API to send signals to process or process group is kill(..), details are as follows:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;signal.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">kill</span><span class="params">(pid_t pid, <span class="keyword">int</span> signo)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">raise</span><span class="params">(<span class="keyword">int</span> signo)</span></span>;</span><br><span class="line">    Both <span class="keyword">return</span>: <span class="number">0</span> <span class="keyword">if</span> OK, −<span class="number">1</span> on error</span><br></pre></td></tr></table></figure>
<p>There are four different conditions for the pid argument to kill.</p>
<ul>
<li><p>pid &gt; 0   The signal is sent to the process whose process ID is pid.</p>
</li>
<li><p>pid==0    The signal is sent to all processes whose process group ID equals the process group ID of the sender and for which the sender has permission to send the signal. Note that the term all processes excludes an implementation-defined set of system processes. For most UNIX systems, this set of system processes includes the kernel processes and init (pid 1).</p>
</li>
<li><p>pid &lt; 0 The signal is sent to all processes whose process group ID equals the absolute value of pid and for which the sender has permission to send the signal. Again, the set of all processes excludes certain system processes, as described earlier.</p>
</li>
<li><p>pid==-1 The signal is sent to all processes on the system for which the sender has permission to send the signal. As before, the set of processes excludes certain system processes.</p>
</li>
</ul>
<p>Let’s write a demo….</p>
<p>The sender code:<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;signal.h&gt;</span></span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(argc != <span class="number">2</span>)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"Usage: signal_sender &lt;pid&gt;\n"</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">pid_t</span> pid = (<span class="keyword">pid_t</span>)atoi(argv[<span class="number">1</span>]);</span><br><span class="line">    kill(pid, SIGUSR1);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<pre><code>The receiver <span class="tag">code</span>:
</code></pre><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;signal.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">sig_usr</span><span class="params">(<span class="keyword">int</span>)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> </span><br><span class="line"><span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(signal(SIGUSR1,sig_usr) == SIG_ERR)&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"cannot catch SIGUSR1!"</span>);</span><br><span class="line">        <span class="built_in">exit</span>(-<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">    <span class="keyword">for</span>(;;)</span><br><span class="line">		pause();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">sig_usr</span><span class="params">(<span class="keyword">int</span> signo)</span></span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(signo == SIGUSR1)</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"received SIGUSR1\n"</span>);</span><br><span class="line">    <span class="keyword">else</span> <span class="built_in">printf</span>(<span class="string">"other signals\n"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>After run the reciever, we got the pid of it, then the sender can send signal SIGUSR1 to it.Result is ok:</li>
</ul>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                <a class="post-title-link" href="/2015/10/21/2015-10-13-Python-read-file/" itemprop="url">
                  python 读取文件的几种方式
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            Posted on
            <time itemprop="dateCreated" datetime="2015-10-21T13:20:05+08:00" content="2015-10-21">
              2015-10-21
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; In
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Python/" itemprop="url" rel="index">
                    <span itemprop="name">Python</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>读《Python核心编程》P208，场景是求文件的最大行长度，发现代码有点问题。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">f = open(<span class="string">'hello.txt'</span>, <span class="string">'r'</span>)</span><br><span class="line">longest = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">	lineLen = len(f.readline().strip())</span><br><span class="line">	<span class="keyword">if</span> <span class="keyword">not</span> lineLen:</span><br><span class="line">		<span class="keyword">break</span></span><br><span class="line">	<span class="keyword">if</span> lineLen &gt; longest:</span><br><span class="line">		longest = lineLen</span><br><span class="line"></span><br><span class="line">f.close()</span><br><span class="line"><span class="keyword">print</span> <span class="string">'Longest Line:'</span>,longest</span><br></pre></td></tr></table></figure>
<p>上述代码，在遇到空行的时候就会break，所以后面的行就不能处理，所以就想到了在Python中如何区分空行和EOF，很显然这里的问题是不能用长度为0作为break的条件，所以应该如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">f = open(<span class="string">'hello.txt'</span>, <span class="string">'r'</span>)</span><br><span class="line">longest = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">	line = f.readline()</span><br><span class="line">	<span class="keyword">if</span> <span class="keyword">not</span> line:</span><br><span class="line">		<span class="keyword">break</span> <span class="comment"># EOF  NB. line == ''</span></span><br><span class="line">	lineLen = len(line.strip())</span><br><span class="line">	<span class="keyword">if</span> lineLen &gt; longest:</span><br><span class="line">		longest = lineLen</span><br><span class="line"></span><br><span class="line">f.close()</span><br><span class="line"><span class="keyword">print</span> <span class="string">'Longest Line:'</span>,longest</span><br></pre></td></tr></table></figure>
<p>这里顺便总结下Python中读取文件的几种方式：</p>
<p>1.如上面，每次读取一行readline()</p>
<p>2.先readlines()得到所有的行到内存中，然后迭代处理这些行，这在处理大文件时有问题</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">allLines = f.readlines()</span><br><span class="line">f.close() </span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> allLines:</span><br><span class="line">	lineLen = len(line.strip())</span><br><span class="line">	<span class="keyword">if</span> lineLen &gt; longest:</span><br><span class="line">		longest = lineLen</span><br></pre></td></tr></table></figure>
<p>等价于</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">allLines = [x.strip() <span class="keyword">for</span> x <span class="keyword">in</span> f.readlines()]</span><br><span class="line">f.close()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> allLines:</span><br><span class="line">	lineLen = len(line)</span><br><span class="line">	<span class="keyword">if</span> lineLen &gt; longest:</span><br><span class="line">		longest = lineLen</span><br></pre></td></tr></table></figure>
<p>3.直接对该文件迭代</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">allLines = [x.strip() <span class="keyword">for</span> x <span class="keyword">in</span> f.readlines()]</span><br><span class="line">f.close() <span class="comment">#...</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> allLines:</span><br><span class="line">	lineLen = len(line)</span><br><span class="line">	<span class="keyword">if</span> lineLen &gt; longest:</span><br><span class="line">		longest = lineLen</span><br></pre></td></tr></table></figure>
<p>4.更简洁的形式使用列表解析的形式，同样列表解析需要所有的行读入内存</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">allLines = [len(x.strip()) <span class="keyword">for</span> x <span class="keyword">in</span> f]</span><br><span class="line">f.close() </span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> <span class="string">'Longest Line:'</span>,max(allLines)</span><br></pre></td></tr></table></figure>
<p>5.进一步，使用生成器表达式替换列表解析</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">longest = max(len(x.strip()) <span class="keyword">for</span> x <span class="keyword">in</span> f)</span><br><span class="line">f.close() </span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> <span class="string">'Longest Line:'</span>,longest</span><br></pre></td></tr></table></figure>
<p>可以发现Python在处理某些任务的时候很方便。</p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                <a class="post-title-link" href="/2015/10/21/2015-10-13-recall-home-1/" itemprop="url">
                  回忆2009（1）
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            Posted on
            <time itemprop="dateCreated" datetime="2015-10-21T13:12:54+08:00" content="2015-10-21">
              2015-10-21
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; In
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Life/" itemprop="url" rel="index">
                    <span itemprop="name">Life</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>今天无意间看到了一些过去备份的照片，然后就沦陷了，很多画面很清晰，但是很多东西却怎么也想不起来，渐渐远去，记得那时候还是一个金利手机，像素不高，但是对我而言却无比珍贵，透过这些我大概能够回忆起当天的轨迹。</p>
<p>我和母亲一同到坡上干活，沿途我拍摄了一些风景，彼时还有我们家的那头牛，应该是最后一头吧！</p>
<blockquote>
<p>母亲的背影</p>
</blockquote>
<p><img src="/assets/home/2009-recall-home-1.jpg" alt=""></p>
<p><img src="/assets/home/2009-recall-home-2.jpg" alt=""></p>
<blockquote>
<p>我们家小牛的正面照</p>
</blockquote>
<p><img src="/assets/home/2009-recall-home-3.jpg" alt=""></p>
<p>五六年的光影一晃而过，发现失去了太多，无法弥补!</p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                <a class="post-title-link" href="/2015/10/21/2015-10-12-广州之旅/" itemprop="url">
                  2015 广州之旅
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            Posted on
            <time itemprop="dateCreated" datetime="2015-10-21T13:12:13+08:00" content="2015-10-21">
              2015-10-21
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; In
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Life/" itemprop="url" rel="index">
                    <span itemprop="name">Life</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>找工作这段时间也是蛮拼的，所以旅个游，放松下。</p>
<blockquote>
<p>第1天，从武汉到广州南，青儿接驾，到达广工大！</p>
</blockquote>
<p><img src="/assets/2015-10-1-travel/10-1.jpeg" alt=""></p>
<blockquote>
<p>第2天，广东早茶，岭南印象园，小蛮腰，珠江夜游，充满崎岖的一天！</p>
</blockquote>
<p><img src="/assets/2015-10-1-travel/10-2-1.jpeg" alt=""></p>
<p><img src="/assets/2015-10-1-travel/10-2-2.PNG" alt=""></p>
<p><img src="/assets/2015-10-1-travel/10-2-3.PNG" alt=""></p>
<blockquote>
<p>第3天，奔赴长洲岛黄埔军校，然后到天河区龙洞山庄，晚上和砀山帮吃烧烤！</p>
</blockquote>
<p><img src="/assets/2015-10-1-travel/10-3.PNG" alt=""></p>
<blockquote>
<p>第4天，强雨，加上敏们，一行5人，海心沙，省博物馆，再看云雾缭绕的小蛮腰，晚上冒雨回去大学城！</p>
</blockquote>
<p><img src="/assets/2015-10-1-travel/10-4.PNG" alt=""></p>
<blockquote>
<p>第5天，城际到达深圳，去大梅沙看海，第一次距离香港那么近！</p>
</blockquote>
<p><img src="/assets/2015-10-1-travel/10-5.PNG" alt=""></p>
<blockquote>
<p>最后一天没来得及看世界之窗，也没来得及吃一顿像样的饭，就离开了！</p>
</blockquote>
<p><img src="/assets/2015-10-1-travel/10-6.PNG" alt=""></p>
<p>多谢青儿和敏的招待，不虚此行。</p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>


 </div>

        

        
      </div>

      
        
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" src="/assets/vonzhou1.jpg" alt="vonzhou" itemprop="image"/>
          <p class="site-author-name" itemprop="name">vonzhou</p>
        </div>
        <p class="site-description motion-element" itemprop="description"></p>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">14</span>
              <span class="site-state-item-name">posts</span>
            </a>
          </div>

          <div class="site-state-item site-state-categories">
            <a href="/categories">
              <span class="site-state-item-count">7</span>
              <span class="site-state-item-name">categories</span>
              </a>
          </div>

          <div class="site-state-item site-state-tags">
            <a href="/tags">
              <span class="site-state-item-count">18</span>
              <span class="site-state-item-name">tags</span>
              </a>
          </div>

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        <div class="links-of-author motion-element">
          
        </div>

      </section>

      

    </div>
  </aside>


      
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner"> <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2015</span>
  <span class="with-love">
    <i class="icon-next-heart fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">vonzhou</span>
</div>

<div class="powered-by">
  Powered by <a class="theme-link" href="http://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT
  </a>
</div>


 </div>
    </footer>

    <div class="back-to-top"></div>
  </div>

  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  
  
    
    

  


  
  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js"></script>
  <script type="text/javascript" src="/js/fancy-box.js?v=0.4.5.2"></script>


  <script type="text/javascript" src="/js/helpers.js?v=0.4.5.2"></script>
  

  <script type="text/javascript" src="/vendors/velocity/velocity.min.js"></script>
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js"></script>

  <script type="text/javascript" src="/js/motion_global.js?v=0.4.5.2" id="motion.global"></script>




  <script type="text/javascript" src="/js/nav-toggle.js?v=0.4.5.2"></script>
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  

  <script type="text/javascript">
    $(document).ready(function () {
      if (CONFIG.sidebar === 'always') {
        displaySidebar();
      }
      if (isMobile()) {
        FastClick.attach(document.body);
      }

      motionIntegrator.bootstrap();
    });
  </script>

  
  

  
  

  
  <script type="text/javascript" src="/js/lazyload.js"></script>
  <script type="text/javascript">
    $(function () {
      $("#posts").find('img').lazyload({
        placeholder: "/images/loading.gif",
        effect: "fadeIn"
      });
    });
  </script>
</body>
</html>
